Type: "AWS::EC2::Instance"
Properties:
  AvailabilityZone: { "Fn::Select": ["0", { "Fn::GetAZs": { "Ref": "AWS::Region" } }] }
  LaunchTemplate:
    LaunchTemplateId: { "Ref": "LaunchTemplate" }
    Version: { "Fn::GetAtt" : [ "LaunchTemplate", "DefaultVersionNumber" ] }
  Tags:
    - Key: Name
      Value: Apache Kafka Kraft Instance dev
  UserData:
    Fn::Base64: !Sub 
    - |
      #!/bin/bash -xe
      
      # Update and install Prometheus
      sudo yum update -y
      sudo yum install -y wget
      wget https://github.com/prometheus/prometheus/releases/download/v2.33.0/prometheus-2.33.0.linux-amd64.tar.gz
      tar xvf prometheus-2.33.0.linux-amd64.tar.gz
      cd prometheus-2.33.0.linux-amd64/
      
      # Start Prometheus
      ./prometheus --config.file=prometheus.yml

    - nodeId: { "Fn::Sub": [ "${nodeId}", { "nodeId": 1 } ] }